<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <title>Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ¬ Î‘Ï€Î¿Î¸ÎµÎ¼Î¬Ï„Ï‰Î½</title>
    <link rel="stylesheet" href="../../assets/css/style.css">
    <style>
        .stats-container {
            max-width: 1200px;
            margin: 2em auto;
            padding: 1em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--card-background);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 1.1rem;
            color: var(--text-color);
            margin-bottom: 1rem;
        }
        
        .stat-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .books-table {
            background: var(--card-background);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .books-table h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .low-stock {
            color: #dc3545;
            font-weight: bold;
        }
        
        .out-of-stock {
            color: #dc3545;
            font-weight: bold;
        }
        
        .good-stock {
            color: #28a745;
            font-weight: bold;
        }
        
        .error-message {
            color: red;
            text-align: center;
            margin-top: 2em;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
        
        .loading {
            text-align: center;
            color: var(--text-secondary);
            font-style: italic;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <button onclick="window.location.href='/pages/owner/dashboard.html'">
                ğŸ  Î‘ÏÏ‡Î¹ÎºÎ®
            </button>
            <button class="logout-btn" onclick="logout()">Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ·</button>
        </nav>
    </header>

    <div class="stats-container">
        <h1 style="text-align: center; color: var(--primary-color); margin-bottom: 2rem;">
            Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ¬ Î‘Ï€Î¿Î¸ÎµÎ¼Î¬Ï„Ï‰Î½
        </h1>
        
        <div id="statsGrid" class="stats-grid">
            <div class="loading">Î¦ÏŒÏÏ„Ï‰ÏƒÎ· ÏƒÏ„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÏÎ½...</div>
        </div>
        
        <div id="booksTable" class="books-table">
            <h3>Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ Î‘Ï€Î¿Î¸ÎµÎ¼Î¬Ï„Ï‰Î½</h3>
            <div id="booksContent" class="loading">Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î²Î¹Î²Î»Î¯Ï‰Î½...</div>
        </div>
    </div>

    <div id="error-message" class="error-message"></div>

    <script src="../../assets/js/functions.js"></script>
    <script>
        if (!localStorage.getItem("jwt")) window.location.href = "../../index.html";

        let allBooks = [];

        function setErrorMessage(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.className = message ? 'error-message show' : 'error-message';
        }

        async function loadStatistics() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/books`, {
                    headers: { 
                        Authorization: `Bearer ${jwtToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                allBooks = await response.json();
                displayStatistics();
                displayBooksTable();
            } catch (error) {
                console.error("Error loading statistics:", error);
                setErrorMessage("Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ ÏƒÏ„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÏÎ½: " + error.message);
            }
        }

        function displayStatistics() {
            const totalBooks = allBooks.length;
            const totalStock = allBooks.reduce((sum, book) => sum + (book.stock || 0), 0);
            const outOfStock = allBooks.filter(book => (book.stock || 0) === 0).length;
            const lowStock = allBooks.filter(book => (book.stock || 0) > 0 && (book.stock || 0) <= 5).length;
            const averageStock = totalBooks > 0 ? (totalStock / totalBooks).toFixed(1) : 0;
            
            const totalValue = allBooks.reduce((sum, book) => {
                const price = parseFloat(book.price) || 0;
                const stock = parseInt(book.stock) || 0;
                return sum + (price * stock);
            }, 0);

            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalBooks}</div>
                    <div class="stat-label">Î£Ï…Î½Î¿Î»Î¹ÎºÎ¬ Î’Î¹Î²Î»Î¯Î±</div>
                    <div class="stat-description">Î”Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ¿Î¯ Ï„Î¯Ï„Î»Î¿Î¹ ÏƒÏ„Î· Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ·</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-number">${totalStock}</div>
                    <div class="stat-label">Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ Î‘Ï€ÏŒÎ¸ÎµÎ¼Î±</div>
                    <div class="stat-description">Î£Ï…Î½Î¿Î»Î¹ÎºÎ­Ï‚ Î¼Î¿Î½Î¬Î´ÎµÏ‚ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-number">${averageStock}</div>
                    <div class="stat-label">ÎœÎ­ÏƒÎ¿ Î‘Ï€ÏŒÎ¸ÎµÎ¼Î±</div>
                    <div class="stat-description">ÎœÎ­ÏƒÎ¿Ï‚ ÏŒÏÎ¿Ï‚ Î¼Î¿Î½Î¬Î´Ï‰Î½ Î±Î½Î¬ Î²Î¹Î²Î»Î¯Î¿</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-number">â‚¬${totalValue.toFixed(2)}</div>
                    <div class="stat-label">Î£Ï…Î½Î¿Î»Î¹ÎºÎ® Î‘Î¾Î¯Î±</div>
                    <div class="stat-description">Î‘Î¾Î¯Î± ÏŒÎ»Î¿Ï… Ï„Î¿Ï… Î±Ï€Î¿Î¸Î­Î¼Î±Ï„Î¿Ï‚</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-number">${outOfStock}</div>
                    <div class="stat-label">Î•Î¾Î±Î½Ï„Î»Î·Î¼Î­Î½Î±</div>
                    <div class="stat-description">Î’Î¹Î²Î»Î¯Î± Ï‡Ï‰ÏÎ¯Ï‚ Î±Ï€ÏŒÎ¸ÎµÎ¼Î±</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-number">${lowStock}</div>
                    <div class="stat-label">Î§Î±Î¼Î·Î»ÏŒ Î‘Ï€ÏŒÎ¸ÎµÎ¼Î±</div>
                    <div class="stat-description">Î’Î¹Î²Î»Î¯Î± Î¼Îµ â‰¤5 Î¼Î¿Î½Î¬Î´ÎµÏ‚</div>
                </div>
            `;
        }

        function displayBooksTable() {
            if (allBooks.length === 0) {
                document.getElementById('booksContent').innerHTML = '<p>Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Î²Î¹Î²Î»Î¯Î±.</p>';
                return;
            }

            const sortedBooks = allBooks.sort((a, b) => (a.stock || 0) - (b.stock || 0));
            
            let tableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Î¤Î¯Ï„Î»Î¿Ï‚</th>
                            <th>Î£Ï…Î³Î³ÏÎ±Ï†Î­Î±Ï‚</th>
                            <th>Î‘Ï€ÏŒÎ¸ÎµÎ¼Î±</th>
                            <th>Î¤Î¹Î¼Î®</th>
                            <th>Î‘Î¾Î¯Î± Î‘Ï€Î¿Î¸Î­Î¼Î±Ï„Î¿Ï‚</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            sortedBooks.forEach(book => {
                const stock = book.stock || 0;
                const price = parseFloat(book.price) || 0;
                const stockValue = stock * price;
                
                let stockClass = 'good-stock';
                if (stock === 0) {
                    stockClass = 'out-of-stock';
                } else if (stock <= 5) {
                    stockClass = 'low-stock';
                }

                tableHtml += `
                    <tr>
                        <td>${book.id || 'N/A'}</td>
                        <td>${book.title || 'N/A'}</td>
                        <td>${book.author || 'N/A'}</td>
                        <td class="${stockClass}">${stock}</td>
                        <td>â‚¬${price.toFixed(2)}</td>
                        <td>â‚¬${stockValue.toFixed(2)}</td>
                    </tr>
                `;
            });

            tableHtml += `
                    </tbody>
                </table>
            `;

            document.getElementById('booksContent').innerHTML = tableHtml;
        }

        loadStatistics();
    </script>
</body>
</html> 